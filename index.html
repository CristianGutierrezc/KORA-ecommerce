<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>K≈åRA - Tienda</title>
  <link rel="stylesheet" href="css/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap" rel="stylesheet" />
  <link rel="manifest" href="manifest.json" />
</head>
<body>

  <!-- SEO: H1 oculto -->
  <h1 style="position:absolute; left:-9999px;">K≈åRA - Moda streetwear futurista</h1>

  <!-- MEN√ö DE NAVEGACI√ìN -->
  <header>
    <nav class="navbar">
      <a href="index.html" class="logo-link">
        <img src="img/logo_kora.png" alt="Logo K≈åRA" class="logo-img" />
      </a>

      <button class="menu-toggle" id="menu-toggle" aria-label="Abrir men√∫">‚ò∞</button>

      <ul class="nav-links" id="nav-links">
        <li><a href="#">Nueva Temporada</a></li>
        <li><a href="#">Mujer</a></li>
        <li><a href="#">Hombre</a></li>
        <li><a href="#">Accesorios</a></li>
        <li><a href="pages/dashboard.html" id="admin-link" style="display:none;">Panel</a></li>
        <li><a href="pages/profile.html" id="perfil-link" style="display:none;">Mi perfil</a></li>
      </ul>

      <div class="icons">
        <span id="usuario-nombre" class="usuario-nombre"></span>
        <a href="pages/form-login.html" id="login-link" class="btn-login-link">Iniciar sesi√≥n</a>
        <a href="#" id="cerrar-sesion" class="btn-login-link" style="display:none;">Cerrar sesi√≥n</a>
        <div id="cart-icon" title="Ver carrito">üõí <span id="cart-count" class="cart-badge">0</span></div>
      </div>
    </nav>

    <!-- Bot√≥n de instalaci√≥n PWA -->
    <div style="text-align: right; padding: 1rem;">
      <button id="instalar-app" style="display:none;" class="btn-instalar">üì≤ Instalar app</button>
    </div>

    <!-- Men√∫ m√≥vil -->
    <div class="menu-mobile" id="menu-mobile">
      <button class="close-menu" id="close-menu" aria-label="Cerrar men√∫">‚úï</button>
      <a href="#">Nueva Temporada</a>
      <a href="#">Mujer</a>
      <a href="#">Hombre</a>
      <a href="#">Accesorios</a>
      <a href="pages/dashboard.html" id="admin-link-mobile" style="display:none;">Panel</a>
      <a href="pages/profile.html" id="perfil-link-mobile" style="display:none;">Mi perfil</a>
      <a href="pages/form-login.html" id="login-link-mobile">Iniciar sesi√≥n</a>
      <a href="#" id="cerrar-sesion-mobile" style="display:none;">Cerrar sesi√≥n</a>
    </div>
  </header>

  <!-- BANNER -->
  <div class="banner">
    <img src="img/banner.png" alt="Banner promocional" />
  </div>

  <!-- MINI CARRITO -->
  <div id="mini-cart" class="mini-cart"></div>

  <!-- CAT√ÅLOGO DE PRODUCTOS -->
  <main>
    <section id="mensaje-vacio">No hay productos disponibles.</section>
    <section id="contenedor-productos" class="grid-productos"></section>
  </main>

  <!-- FOOTER -->
  <footer>
    <p>&copy; 2025 K≈åRA. Todos los derechos reservados.</p>
  </footer>

  <!-- SCRIPTS -->
  <script type="module" src="js/controllers/home.controller.js"></script>
  <script type="module" src="js/controllers/carrito.controller.js"></script>
  <script type="module" src="js/utils/fnStorages.js"></script>
  <script type="module" src="js/utils/validaciones.js"></script>
  <script type="module" src="js/utils/cookies.js"></script>

  <!-- Control de sesi√≥n -->
  <script type="module">
    import { getCookie, borrarCookie } from './js/utils/cookies.js';

    document.addEventListener('DOMContentLoaded', () => {
      const sesion = getCookie('sesionKora');
      const user = sesion ? JSON.parse(sesion) : null;

      const nombreSpan = document.getElementById('usuario-nombre');
      const cerrarBtn = document.getElementById('cerrar-sesion');
      const cerrarBtnMobile = document.getElementById('cerrar-sesion-mobile');
      const loginLink = document.getElementById('login-link');
      const loginLinkMobile = document.getElementById('login-link-mobile');
      const adminLink = document.getElementById('admin-link');
      const adminLinkMobile = document.getElementById('admin-link-mobile');
      const perfilLink = document.getElementById('perfil-link');
      const perfilLinkMobile = document.getElementById('perfil-link-mobile');

      if (user) {
        nombreSpan.textContent = `üë§ ${user.nombre}`;
        cerrarBtn.style.display = 'inline-block';
        cerrarBtnMobile.style.display = 'block';
        loginLink.style.display = 'none';
        loginLinkMobile.style.display = 'none';
        perfilLink.style.display = 'inline-block';
        perfilLinkMobile.style.display = 'block';

        if (user.rol === 'admin') {
          adminLink.style.display = 'inline-block';
          adminLinkMobile.style.display = 'block';
        }
      }

      cerrarBtn?.addEventListener('click', () => {
        borrarCookie('sesionKora');
        localStorage.removeItem('sesionActiva');
        window.location.href = 'index.html';
      });

      cerrarBtnMobile?.addEventListener('click', () => {
        borrarCookie('sesionKora');
        localStorage.removeItem('sesionActiva');
        window.location.href = 'index.html';
      });
    });
  </script>

  <!-- Men√∫ hamburguesa -->
  <script>
    const toggleBtn = document.getElementById('menu-toggle');
    const closeBtn = document.getElementById('close-menu');
    const mobileMenu = document.getElementById('menu-mobile');

    toggleBtn.addEventListener('click', () => {
      mobileMenu.classList.add('active');
      document.body.classList.add('menu-abierto');
    });

    closeBtn.addEventListener('click', () => {
      mobileMenu.classList.remove('active');
      document.body.classList.remove('menu-abierto');
    });

    document.querySelectorAll('.menu-mobile a').forEach(link => {
      link.addEventListener('click', () => {
        mobileMenu.classList.remove('active');
        document.body.classList.remove('menu-abierto');
      });
    });
  </script>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(reg => console.log('SW registrado ‚úÖ', reg))
          .catch(err => console.error('Error al registrar SW ‚ùå', err));
      });
    }
  </script>

  <!-- Bot√≥n de instalaci√≥n manual -->
  <script>
    let deferredPrompt;
    const btnInstalar = document.getElementById('instalar-app');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      btnInstalar.style.display = 'inline-block';

      btnInstalar.addEventListener('click', () => {
        btnInstalar.style.display = 'none';
        deferredPrompt.prompt();

        deferredPrompt.userChoice.then(choice => {
          if (choice.outcome === 'accepted') {
            console.log('‚úÖ App instalada');
          } else {
            console.log('‚ùå Usuario cancel√≥ la instalaci√≥n');
          }
          deferredPrompt = null;
        });
      });
    });

    window.addEventListener('appinstalled', () => {
      console.log('‚úÖ La app fue instalada');
      btnInstalar.style.display = 'none';
    });
  </script>

</body>
</html>
